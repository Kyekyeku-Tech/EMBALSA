<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>New Registration</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="/CSS/link.css">
  <link rel="icon" href="/Images/emba.jpg" type="image/x-icon">
</head>
<body>
  <div class="form-container">
    <img src="/Images/emba.jpg" alt="Emba Logo" class="logo" />
    <h1>New Agent Reg.</h1>
    <form id="agentForm" action="https://api.sheetmonkey.io/form/3Z9cWbbWx73ucYjQM1HsAQ" method="POST">
      <input type="hidden" name="x-sheetmonkey-insert-worksheet" value="HALF ASSINI">
      <input type="hidden" id="TIMESTAMP" name="TIMESTAMP">

      <div class="mb-3">
        <label for="agentName" class="form-label">Agent Name</label>
        <input type="text" id="agentName" name="Agent Name" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="businessName" class="form-label">Business Name</label>
        <input type="text" id="businessName" name="Business Name" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="agentNumber" class="form-label">Agent Number</label>
        <input type="tel" id="agentNumber" name="Agent Number" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="personalNumber" class="form-label">Personal Number</label>
        <input type="tel" id="personalNumber" name="Personal Number" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="location" class="form-label">Location</label>
        <input type="text" id="location" name="Location" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">Submit</button>
      <div class="toggle-link">
        <a href="delink.html">Agent want to leave? De-link</a>
      </div>
    </form>
  </div>

  <div class="list-container">
    <h1>Agent Registered</h1>
    <button class="btn btn-secondary mb-3" onclick="toggleAgents()">View Agents</button>
    <div id="agentSection" style="display: none;">
      <div class="total" id="totalCount">Total Agents: 0</div>
      <ul id="agentList"></ul>
    </div>
  </div>

  <script>
    let agents = JSON.parse(localStorage.getItem("agents")) || [
      "Graphy Enterprise",
"Good seed of Djabah",
"Richard Appiah Asiedu",
"Nkwasuo Miniral Water",
"LoveJenney Ventures-Evans",
"Mr shop Ghana limited", 
"Just Blow business enterprise", 
"Ebenezer Annor",
"Senix Enterprise",
"Nana Benya Ventures",
"Ishmael Tawiah",
"JERRYPASS ENTERPRISE",
"Blissful Venture",
"ROCK OF AGES VENTURES",
"Coaches Ventures Adam karim",
"Mary Magdaline Dadzi",
"Rosemond Wangalah-Louicom Enterprise",
"EMBALINKS Telecom-Rebecca Nwodomeh",
"T/A FIRST AID MEDICINE-Bashir Din",
"Kwabena Dwomor - AB Casino Ventures",
"ELIZABETH DEBY VENTURES",
"Augustine	Godsok Ventures",
"Bernard Agyei	Adam Bi ventures",
"THOMAS GYEDU-Thomas Gyedu Ventures",
"GRACE GYEDU	Grace Gyedu Ventures",
	"Thesskiki Enterprise",
"Micheal Caesar	Micheal Caesar",
	"God Sok Ventures",
"Augustina Kwofie-THomas Ehyimah",
"LORETTA -Loretta Hub",
"Peter Kofi Brenya	Peter Kofi Brenya Ventures",
"Solomon	Paa solo one man venture",
"Beatrice Anyimah	BEATRICE ANYIMAH",
"Uncle Tano	Uncle Tanoâ€™s Enterprise"	
];
    function updateAgentDisplay() {
      document.getElementById("totalCount").textContent = `Total Agents: ${agents.length}`;
      const list = document.getElementById("agentList");
      list.innerHTML = "";
      agents.forEach((agent, index) => {
        const li = document.createElement("li");
        li.textContent = `${index + 1}. ${agent}`;
        list.appendChild(li);
      });
    }

    function toggleAgents() {
      const section = document.getElementById("agentSection");
      section.style.display = section.style.display === "none" ? "block" : "none";
    }

    function appendTimestamp() {
      const now = new Date();
      const timestamp = `${now.toLocaleDateString()} ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
      document.getElementById('TIMESTAMP').value = timestamp;
    }

    document.getElementById('agentForm').addEventListener('submit', function(e) {
      e.preventDefault();
      appendTimestamp();

      const form = e.target;
      const agentName = document.getElementById('agentName').value.trim();
      const businessName = document.getElementById('businessName').value.trim();

      fetch(form.action, {
        method: form.method,
        body: new FormData(form)
      })
      .then(response => {
        if (response.ok) {
          Swal.fire({
            icon: 'success',
            title: 'Submitted!',
            text: 'Your data has been submitted successfully.',
            confirmButtonText: 'Submit New Request'
          }).then(() => {
            // Add to agents list and save
            agents.push(`${agentName} - ${businessName}`);
            localStorage.setItem("agents", JSON.stringify(agents));
            updateAgentDisplay();
            form.reset();
          });
        } else {
          throw new Error('Submission failed');
        }
      })
      .catch(error => {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Something went wrong. Please try again.',
        });
      });
    });

    // Initial load
    updateAgentDisplay();
  </script>
</body>
</html>
